<!-- THIS FILE IS WHERE OUR APP WILL GO -->
{% load staticfiles %}
<!DOCTYPE html>
<html>
  <head>
    <title>SafeCollab</title>
    <link href='http://fonts.googleapis.com/css?family=Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "safecollabapp/css/index.css" %}" rel="stylesheet">
    <script src="{% static "safecollabapp/js/notify.min.js" %}" type="text/javascript"></script>
    <script src="{% static "safecollabapp/js/index.js" %}" type="text/javascript"> </script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>
    <script>
      $(document).ready(function() {
        $('.select_userbox').select2({
          placeholder: "Select a User",
          allowClear: false
        });
      })
    </script>

  </head>

  <nav class="navbar navbar-fixed-top transparent">
    <div class="container">
      <!--<ul class="nav navbar-nav navbar-left">
        <li><a href="#">Left</a></li>
        <li><a href="#about">Left</a></li>
      </ul>-->
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/logout/"><span style="color: white">Logout</span></a></li>
      </ul>
    </div>
  </nav>

  <body>
    <br/>
    <div class="container" style="height:100%">
      <div class="row" style="height:100%">
        <div class="col-md-12" style="height:100%">
          <div class="panel" style="height:100%">
            <div class="panel-body" style="height:100%">
              <div class="row" style="height:100%">
                <div class="col-md-3" style="height:100%">
                  <span style="text-align: center">
                    <ul class="nav nav-pills nav-stacked">
                        <li class="active"><a href="#reports" data-toggle="tab">Reports and Files</a></li>
                        <li><a href="#manage-groups" data-toggle="tab">Manage Groups</a></li>
                        <li><a href="#messages" data-toggle="tab">Messages</a></li>
                        {% if is_manager %}
                        <li><a href="#site-manager" data-toggle="tab">Site Manager</a></li>
                        {% endif %}
                    </ul>
                  </span>
                </div>
                <div class="col-md-9" style="height:100%">
                  <div class="tab-content">
                    <div id="reports" class="tab-pane fade in active">
                      <ul class="nav nav-tabs">
                          <li class="active"><a href="#view-reports" data-toggle="tab">View Reports</a></li>
                          <li><a href="#create-reports" data-toggle="tab">Create a Report</a></li>
                          <li><a href="#view-files" data-toggle="tab">View Files</a></li>
                          <li><a href="#search-reports" data-toggle="tab">Search Reports</a></li>
                      </ul>
                      <div class="tab-content">
                        <div id="view-reports" class="tab-pane active">
                          <div class="container" style="height:100%; width:100%">
                            <div class="row">
                              <div class="col-sm-12">
                                <h3>Reports</h3>
                              </div>
                            </div>
                            <div class="row" style="height:100%; width:100%">
                              <div class="col-sm-4">
                                <div class="list-group">
                                  {% for folder in folders_list %}
                                    <div id="open-folder-button">
                                      <form action="/open_folder/" class="open-folder-form" method="POST">
                                        {% csrf_token %}
                                        <button type="submit" class="list-group-item" name="folder_name" id="folder_name" value="{{folder.name}}">
                                          <span id="folder-glyph" class="glyphicon glyphicon-folder-close"></span> {{folder.name}}
                                        </button>
                                      </form>
                                    </div>
                                  {% endfor %}
                                  {% for report in reports_list %}
                                    <form action="/view_report/" class="view-report-form" method="POST">
                                      {% csrf_token %}
                                      <button type="submit" class="list-group-item" name="report_name" id="report_name" value="{{report.short_desc}}">{{report.short_desc}}
                                    {% if report.private %}
                                      <span class="label label-default label-pill pull-sm-right">Private</span>
                                    {% endif %}
                                    </button>
                                    </form>
                                  {% endfor %}
                                  <form action="" class="create-folder-form" method="POST">
                                    <button type="submit" class="list-group-item" name="create_folder" id="create_folder" value="Create Folder">
                                      <span class="glyphicon glyphicon-plus"></span> Create Folder
                                    </button>
                                  </form>
                                </div>
                              </div>
                              <div class="col-sm-8">
                                <div id="viewreport-response"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div id="create-reports" class="tab-pane">
                          <h3>Create a Report</h3>
                          <form action="/create_report/" method="POST" id="form-createreport" enctype="multipart/form-data">
                          {% csrf_token %}
                          <div class="form-group">
                            <label for="short_desc">Name:</label><input type="text" name="short_desc" id="short_desc" maxlength="120" class="form-control" />
                            <label for="long_desc">Description:</label><textarea name="long_desc" rows="8" id="long_desc" class="form-control"></textarea>
                            <label for="folder">Folder:</label>
                            <select name="folder" id="folder" class="form-control">
                                <option selected="selected" value=""></option>
                              {% for folder in folders_list %}
                                <option value="{{ folder.name }}">{{ folder.name }}</option>
                              {% endfor %}
                            </select>
                            <label for="private">Mark as private:</label><input type="checkbox" name="private" id="private" />
                            <!-- File upload fields -->
                            <p>{{ doc_form.non_field_errors }}</p>

                            <p>{{ doc_form.docfile.label_tag }} {{ doc_form.docfile.help_text }}</p>
                            <p>
                                {{ doc_form.fname.label_tag }} {{ doc_form.fname.help_text }}
                                {{ doc_form.fname.errors }}
                                {{ doc_form.fname }}
                            </p>
                            <p>
                                {{ doc_form.docfile.errors }}
                                {{ doc_form.docfile }}
                            </p>
                            <p>
                                {{ doc_form.encrypted.label_tag }} {{ doc_form.encrypted.help_text }}
                                {{ doc_form.encrypted.errors }}
                                {{ doc_form.encrypted }}
                            </p>
                            <input type="submit" value="Create Report" class="form-control btn btn-primary" />
                          </div>
                          </form>
                        </div>
                        <div id="view-files" class="tab-pane">
                          <div class="container" style="height:100%; width:100%">
                            <div class="row">
                              <div class="col-sm-12">
                                <h3>Files</h3>
                              </div>
                            </div>
                            <div class="row" style="height:100%; width:100%">
                              <div class="col-sm-4">
                                <div class="list-group">
                                  {% if files_list|length > 0 %}
                                    {% for file in files_list %}
                                      <form action="/view_file/" class="view-file-form" method="POST">
                                        {% csrf_token %}
                                        <button type="submit" class="list-group-item" name="file_name" id="file_name" value="{{file.name}}">{{file.name}}
                                        </button>
                                      </form>
                                    {% endfor %}
                                  {% else %}
                                    <h4><em>No files found.</em></h4>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="col-sm-8">
                                <div id="viewfile-response"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div id="search-reports" class="tab-pane">
                            <h3>Search for Reports</h3>
                            <form action="/search_reports/" id="search-form" method="POST">
                                {% csrf_token %}
                                    <div class="form-group">
                                        <input type="text" name="search-reports-all" id="search-reports-all" tabindex="1" class="form-control" placeholder="All Fields">
                                        <input type="text" name="search-reports-short_desc" id="search-reports-short_desc" tabindex="1" class="form-control" placeholder="Name">
                                        <input type="text" name="search-reports-long_desc" id="search-reports-long_desc" tabindex="1" class="form-control" placeholder="Description">
                                        <input type="text" name="search-reports-owner" id="search-reports-owner" tabindex="1" class="form-control" placeholder="Owner">
                                        <input type="number" name="search-reports-num_results" id="search-reports-num_results" tabindex="1" class="form-control" placeholder="Number of results">
                                        <input type="submit" name="search-submit" id="search-submit" tabindex="1" class="form-control btn btn-primary" value="Search" data-target="#search-results-table">
                                    </div>
                            </form>
                            <table class="table table-hover" id="search-results-table" style="table-layout: fixed; width: 100%">
                                <thead>
                                  <tr>
                                      <th style="width:25%">Name</th>
                                      <th style="width:45%">Description</th>
                                      <th style="width:20%">Owner</th>
                                      <th style="width:10%">Access</th>
                                  </tr>
                                </thead>
                                <tbody>
                                    <!-- <div class="search-results"></div> -->
                                  {% for result in search_results %}
                                    <tr>
                                        <td> {{ result.short_desc }} </td>
                                        <td style="word-wrap: break-word"> {{ result.long_desc }} </td>
                                        <td> {{ result.owner.username }} </td>
                                        <td><!-- access goes here! --></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                          </div>
                      </div>
                    </div>

                    <div id="manage-groups" class="tab-pane fade">
                      <table class="table table-hover" id="groups_table">
                        <thead>
                          <tr>
                            <th>Group</th>
                            <th>Number of Members</th>
                            <th>User</th>
                            <th>Add</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for g in groups %}
                          <tr>
                            <td>{{ g.group.name }}</td>
                            <td class="td_num_users", id="td_num_users_{{ g.group.name }}">{{ g.num_users }}</td> 
                            <td>
                              <select class="select_userbox" id="select_{{ g.group.name }}" style="width:100%">
                                <option />
                                {% for user in users_list %}
                                  <option value="{{ user.username }}">{{ user.username }}</option>
                                {% endfor %}
                              </select>
                            </td>
                            <td>
                              <button type="submit" class="btn btn-primary add_user_to_group_button" id="add_button_{{ g.group.name }}">Add User</button>
                            </td>
                          </tr>
                          {% endfor %}
                      </table>

                      <!-- Trigger the modal with a button -->
                      <button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#create-group">Create New Group</button>

                      <!-- Modal -->
                      <div id="create-group" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                              <h4 class="modal-title">Create a New Group</h4>
                            </div>
                            <div class="modal-body">
                              <div class="form-group">
                                <label for="group_name"><span class="glyphicon glyphicon-user"></span> Group Name</label>
                                <input type="text" class="form-control" id="group_name" placeholder="Enter the name of your group" autofocus>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <div class="pull-left" id="create_group_response" style="text-align:left; color:red"></div>
                              <form role="form">
                                <button type="button" class="btn btn-default" id="create_group_cancel" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-default" id="create_group_button">Create</button>
                              </form>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>

                    <div id="messages" class="tab-pane fade">
                      <ul class="nav nav-tabs">
                        <li class="active"><a href="#viewmessages" data-toggle="tab">View Messages</a></li>
                        <li><a href="#sendmessages" data-toggle="tab">Send Messages</a></li>
                      </ul>
                      <div class="tab-content">
                        <div id="viewmessages" class="tab-pane active">
                          <div class="container">
                            {% for message in messages_list %}
                            <div class="row">
                              From: {{ message.sender.username }}
                            </div>
                            <div class="row">
                              {{ message.time }}
                            </div>
                            <div class="row">
                              {{ message.text }}
                            </div>
                            {% endfor %}
                          </div>
                        </div>
                        <div id="sendmessages" class="tab-pane">
                          <div class="container" id="send-message-form-container">
                            <br/>
                            <form id="send-message-form" action="/sendmessage/" method="post" role="form">
                              {% csrf_token %}
                              <div class="row">
                                <div class="form-group">
                                  <div class="col-lg-8">
                                    <label>Select User:</label>
                                    <select name="recipient" class="form-control">
                                      {% for user in users_list %}
                                        <option value="{{ user.username }}">{{ user.username }}</option>
                                      {% endfor %}
                                    </select>
                                  </div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="form-group">
                                  <div class="col-lg-8">
                                    <textarea rows="8" name="message" class="form-control"></textarea>
                                  </div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="form-group">
                                  <div class="col-lg-2">
                                    <input type="submit" value="Send" class="form-control" />
                                  </div>
                                </div>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div id="site-manager" class="tab-pane fade">
                      <ul class="nav nav-tabs">
                        <li class="active"><a href="#assign-manager" data-toggle="tab">Assign Managers</a></li>
                        <li><a href="#sitemanager-users" data-toggle="tab">Manage Users</a></li>
                        <li><a href="#sitemanager-groups" data-toggle="tab">Manage Groups</a></li>
                        <li><a href="#sitemanager-reports" data-toggle="tab">All Reports</a></li>
                      </ul>
                      <div class="tab-content">
                        <div id="assign-manager" class="tab-pane fade">
                          <div id="addmanager-response"></div><br />
                          Current Site-Managers: <br/>
                          <div id="manager-list">
                            <ul>
                              {% for user in site_managers_list %}
                              <li> {{ user.username }} </li>
                              {% endfor %}
                            </ul>
                          </div>
                          <form action="/add_manager/" method="POST" id="form-addmanager">
                          {% csrf_token %}
                            <div class="form-group" style="width:40%">
                              Add another: <input type="text" name="username" id="username" tabindex="1" class="form-control" placeholder="Username" value="">
                            </div>
                          </form>
                        </div>
                        <div id="sitemanager-users" class="tab-pane fade">
                          <div id="manageusers-response"></div><br />
                          Current Users: <br/>
                          <div id="user-list">
                            <ul>
                              {% for user in users_list %}
                              <li> {{ user.username }} <a href="#" class="link-suspend" id="{{ user.username }}"> Suspend </a> <a href="#" class="link-restore" id="{{ user.username }}"> Restore </a></li>
                              {% endfor %}
                            </ul>
                          </div>
                        </div>
                        <div id="sitemanager-groups" class="tab-pane fade">
                          <br/>
                          <table class="table table-hover" id="groups_table">
                            <thead>
                              <tr>
                                <th>Group</th>
                                <th>Number of Members</th>
                                <th>User</th>
                                <th>Add</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for g in groups %}
                              <tr>
                                <td>{{ g.group.name }}</td>
                                <td class="td_num_users", id="td_num_users_{{ g.group.name }}">{{ g.num_users }}</td> 
                                <td>
                                  <select class="select_userbox" id="select_{{ g.group.name }}" style="width:100%">
                                    <option />
                                    {% for user in users_list %}
                                      <option value="{{ user.username }}">{{ user.username }}</option>
                                    {% endfor %}
                                  </select>
                                </td>
                                <td>
                                  <button type="submit" class="btn btn-primary add_user_to_group_button" id="add_button_{{ g.group.name }}">Add User</button>
                                </td>
                              </tr>
                              {% endfor %}
                          </table>

                      <!-- Trigger the modal with a button -->
                          <button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#sitemanager-create-group">Create New Group</button>
                          <!-- Modal -->
                          <div id="sitemanager-create-group" class="modal fade" role="dialog">
                            <div class="modal-dialog">
                              <!-- Modal content-->
                              <div class="modal-content">
                                <div class="modal-header">
                                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                                  <h4 class="modal-title">Create a New Group</h4>
                                </div>
                                <div class="modal-body">
                                  <div class="form-group">
                                    <label for="group_name"><span class="glyphicon glyphicon-user"></span> Group Name</label>
                                    <input type="text" class="form-control" id="group_name" placeholder="Enter the name of your group" autofocus>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <div class="pull-left" id="create_group_response" style="text-align:left; color:red"></div>
                                  <form role="form">
                                    <button type="button" class="btn btn-default" id="create_group_cancel" data-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-default" id="sitemanager_create_group_button">Create</button>
                                  </form>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div id="sitemanager-reports" class="tab-pane fade">
                          <div class="container" style="height:100%; width:100%">
                            <div class="row">
                              <div class="col-sm-12">
                                <h3>Reports</h3>
                              </div>
                            </div>
                            <div class="row" style="height:100%; width:100%">
                              <div class="col-sm-4">
                                <div class="list-group">
                                  {% for report in all_reports %}
                                    <form action="/view_report/" class="sitemanager-view-report-form" method="POST">
                                      {% csrf_token %}
                                      <button type="submit" class="list-group-item" name="report_name" id="report_name" value="{{report.short_desc}}"/>{{report.short_desc}}
                                    {% if report.private %}
                                      <span class="label label-default label-pill pull-right">Private</span>
                                    {% endif %}
                                    </button>
                                    </form>
                                  {% endfor %}
                                </div>
                              </div>
                              <div class="col-sm-8">
                                <div id="sitemanager-viewreport-response"></div>
                                <div id="sitemanager-viewreport-delete"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <footer>
    <p class="muted credit"> Site created and maintained by Bradley Barrett, Ryan Duffin, Liam Dwyer, and Nikhil Gupta.</p>
    <em>Copyright &copy; 2016</em>
  </footer>
</html>
